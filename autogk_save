local ToggleButton = require(script.Parent.gui_loader) -- если gui_loader.lua - в родителе, или замените на свой путь

local plr = game.Players.LocalPlayer
local runService = game:GetService("RunService")

local autoGKEnabled = false
local connection

-- Функция автоГК
local function autoGK()
    local char = plr.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    local ball = nil
    local goal = workspace:FindFirstChild("HomeGoal") or workspace:FindFirstChild("AwayGoal")
    local gkpos = workspace:FindFirstChild("HomeGKSpawn") or workspace:FindFirstChild("AwayGKSpawn")
    if not goal or not gkpos then return end
    
    -- Найти мяч
    for _, obj in pairs(workspace:GetChildren()) do
        if obj:IsA("BasePart") and obj.Name:lower():find("ball") then
            ball = obj
            break
        end
    end
    if not ball then return end
    
    local distance = (ball.Position - goal.Position).Magnitude
    local followSpeed = 3
    local activeDistance = 150
    
    if distance < activeDistance then
        local targetPos = Vector3.new(ball.Position.X, hrp.Position.Y, gkpos.Position.Z)
        local move = (targetPos - hrp.Position).Unit * followSpeed
        hrp.Velocity = Vector3.new(move.X * 10, 0, move.Z * 10)
    else
        local backPos = Vector3.new(gkpos.Position.X, hrp.Position.Y, gkpos.Position.Z)
        local move = (backPos - hrp.Position).Unit * (followSpeed * 0.8)
        hrp.Velocity = Vector3.new(move.X * 10, 0, move.Z * 10)
    end
end

-- Включить/выключить автоГК
ToggleButton.MouseButton1Click:Connect(function()
    autoGKEnabled = not autoGKEnabled
    ToggleButton.Text = "Auto GK: " .. (autoGKEnabled and "ON" or "OFF")
    
    if autoGKEnabled then
        connection = runService.Heartbeat:Connect(function()
            autoGK()
        end)
    else
        if connection then
            connection:Disconnect()
            connection = nil
        end
    end
end)
